<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GT7 Racing Championship 2025</title>
  <link rel="stylesheet" href="./GT7style.css" />
  <script>
    // showTab early so inline onclick handlers work
    window.showTab = function(tab, evt){
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      if(evt && evt.target) evt.target.classList.add('active');
      document.querySelectorAll('.tab-content').forEach(el=>el.classList.add('hidden'));
      const el = document.getElementById(tab);
      if(el) el.classList.remove('hidden');
    };
  </script>
</head>
<body>
  <div class="container">
    <header>
      <h1>üèÅ GT7 Racing Championship 2025</h1>
      <div class="small">P≈ôehled z√°vod≈Ø, v√Ωsledk≈Ø a statistik</div>
      <div class="auth-controls">
        <button id="btn-signin" class="btn" onclick="signIn()">P≈ôihl√°sit se (admin)</button>
        <button id="btn-signout" class="btn secondary hidden" onclick="signOutUser()">Odhl√°sit se</button>
        <span id="user-email" class="small"></span>
      </div>
    </header>

    <div class="tabs">
      <button class="tab active" onclick="showTab('current', event)">Aktu√°ln√≠ sez√≥na</button>
      <button class="tab" onclick="showTab('archive', event)">Archiv</button>
      <button class="tab" onclick="showTab('hall', event)">Hall of Fame</button>
      <button class="tab" onclick="showTab('admin', event)">Admin</button>
    </div>

    <main>
      <section id="current" class="tab-content">
        <div class="section">
          <h2>Pr≈Øbƒõ≈æn√© po≈ôad√≠</h2>
          <div class="leaderboard-controls">
            <input id="search-driver" placeholder="üîç Hledat jezdce">
            <label>Min. starty: <input id="min-starts" type="number" min="0" value="0"></label>
            <label>Sez√≥na: <select id="season-select"></select></label>
          </div>
          <div id="leaderboard-container"></div>
          <canvas id="points-chart" style="margin-top:20px; max-height:400px;"></canvas>
        </div>

        <div class="section">
          <h2>Statistiky</h2>
          <div id="stats-container"></div>
        </div>

        <div class="section">
          <h2>V√Ωsledky z√°vod≈Ø</h2>
          <div id="past-races"></div>
        </div>
      </section>

      <section id="archive" class="tab-content hidden">
        <div class="section">
          <h2>Archiv sez√≥n</h2>
          <div id="archive-content"></div>
        </div>
      </section>

      <section id="hall" class="tab-content hidden">
        <div class="section">
          <h2>Hall of Fame üèÜ</h2>
          <div id="hall-of-fame"></div>
          <canvas id="hall-bar-chart" style="max-height:300px;margin-top:12px;"></canvas>
        </div>
        <div class="section">
          <h2>Fun facts ü§ì</h2>
          <div id="fun-facts"></div>
        </div>
      </section>

      <section id="admin" class="tab-content hidden">
        <div class="section">
          <h2>Admin</h2>
          <div id="admin-forms" class="hidden">
            <h3>P≈ôidat / upravit z√°vod</h3>
            <form id="race-form">
              <input type="hidden" id="edit-id" />
              <div class="form-row">
                <label>Datum: <input type="date" id="race-date" required></label>
                <label>Okruh: <input id="circuit-name" required></label>
              </div>
              <div class="form-row">
                <label>Povolen√° auta: <input id="allowed-cars"></label>
                <label>Info: <input id="additional-info"></label>
              </div>
              <div style="margin-top:8px">
                <button class="btn" type="submit">Ulo≈æit z√°vod</button>
                <button type="button" class="btn secondary" onclick="resetRaceForm()">Reset</button>
              </div>
            </form>

            <hr>

            <h3>Zadat v√Ωsledky (1.‚Äì5. m√≠sto + DNS)</h3>
            <form id="results-form">
              <label>Vyber z√°vod: <select id="select-race"></select></label>
              <div id="positions-container" class="grid-results"></div>
              <div style="margin-top:8px">
                <label>YouTube URL: <input type="url" id="youtube-url" placeholder="https://www.youtube.com/watch?v=..."></label>
                <button class="btn" type="submit">Ulo≈æit v√Ωsledky</button>
                <button type="button" class="btn secondary" onclick="resetResultsForm()">Reset</button>
              </div>
            </form>

            <hr>
            <h3>Seznam z√°vod≈Ø (admin)</h3>
            <div id="admin-race-list" class="admin-list"></div>
          </div>
          <div id="not-admin" class="small">P≈ôihlaste se jako admin (Google) pro √∫pravy.</div>
        </div>
      </section>
    </main>
  </div>

  <!-- driver modal -->
  <div id="driver-modal" class="modal hidden">
    <div class="modal-content">
      <button class="close-btn" onclick="closeDriverModal()">‚úï</button>
      <h2 id="driver-name"></h2>
      <div id="driver-summary"></div>
      <canvas id="driver-points-chart" style="max-height:300px;margin:10px 0;"></canvas>
      <div id="driver-race-history"></div>
    </div>
  </div>

  <!-- Chart.js UMD (global Chart) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>

  <!-- App script (module) -->
  <script type="module" src="./GT7script.js"></script>
</body>
</html>
