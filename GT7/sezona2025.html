<!doctype html>
<html lang="cs">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>GT7 Racing Championship</title>
    <style>
      /* --- Styly zachov치ny z p콏edchoz칤 verze (zkr치ceno pro p콏ehlednost) --- */
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>游끠 GT7 Racing Championship</h1>
            <div class="subtitle">Ofici치ln칤 p콏ehled z치vod콢 a v칳sledk콢</div>
        </header>

        <div class="tabs">
            <button class="tab active" onclick="showTab('current', event)">Aktu치ln칤 sez칩na</button>
            <button class="tab" onclick="showTab('archive', event)">Archiv</button>
            <button class="tab" onclick="showTab('admin', event)">Admin</button>
        </div>

        <div id="current-tab">
            <div id="countdown-container"></div>
            <div class="section animate-in">
                <h2>Pr콢b캩쬹칠 po콏ad칤</h2>
                <table class="standings-table">
                    <thead>
                        <tr>
                            <th>Jezdec</th>
                            <th>游볞 1. m칤sta</th>
                            <th>游볟 2. m칤sta</th>
                            <th>游볠 3. m칤sta</th>
                            <th>Body</th>
                        </tr>
                    </thead>
                    <tbody id="standings-body"></tbody>
                </table>
            </div>

            <div class="chart-container animate-in">
                <h2>V칳voj bod콢 v sez칩n캩</h2>
                <div id="points-chart"></div>
            </div>

            <div class="section">
                <h2>Nadch치zej칤c칤 z치vody</h2>
                <div id="upcoming-races"></div>
            </div>

            <div class="section">
                <h2>Prob캩hl칠 z치vody</h2>
                <div class="filter-bar">
                    <input type="text" id="filter-manufacturer" class="filter-input" placeholder="游댌 V칳robce">
                    <input type="text" id="filter-drivetrain" class="filter-input" placeholder="游댌 Pohon">
                    <input type="text" id="filter-circuit" class="filter-input" placeholder="游댌 Okruh">
                    <button class="btn" onclick="clearFilters()">Vymazat filtry</button>
                </div>
                <div id="past-races"></div>
            </div>
        </div>

        <div id="archive-tab" class="hidden">
            <div class="section">
                <h2>Archiv minul칳ch sez칩n</h2>
                <div id="archive-content"></div>
            </div>
        </div>

        <div id="admin-tab" class="hidden">
            <div class="section">
                <h2>P콏idat nov칳 z치vod</h2>
                <form id="race-form">
                    <div class="form-group">
                        <label>Datum</label>
                        <input type="date" id="race-date" required>
                    </div>
                    <div class="form-group">
                        <label>N치zev okruhu</label>
                        <input type="text" id="circuit-name" required>
                    </div>
                    <div class="form-group">
                        <label>Povolen치 vozidla</label>
                        <input type="text" id="allowed-cars" required>
                    </div>
                    <div class="form-group">
                        <label>Index v칳konu</label>
                        <input type="text" id="performance-index">
                    </div>
                    <div class="form-group">
                        <label>Tuning</label>
                        <select id="tuning">
                            <option value="Povolen">Povolen</option>
                            <option value="Zak치z치n">Zak치z치n</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Pneumatiky</label>
                        <input type="text" id="tires">
                    </div>
                    <div class="form-group">
                        <label>Po캜et kol</label>
                        <input type="number" id="laps">
                    </div>
                    <div class="form-group">
                        <label>Rychlost opot콏eben칤 pneumatik</label>
                        <input type="text" id="tire-wear">
                    </div>
                    <div class="form-group">
                        <label>Rychlost spot콏eby paliva</label>
                        <input type="text" id="fuel-consumption">
                    </div>
                    <div class="form-group">
                        <label>Rychlost dopl켿ov치n칤 paliva v boxech</label>
                        <input type="text" id="refuel-speed">
                    </div>
                    <div class="form-group">
                        <label>Dopl켿uj칤c칤 informace</label>
                        <textarea id="additional-info" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>V칳robce</label>
                        <input type="text" id="manufacturer">
                    </div>
                    <div class="form-group">
                        <label>Typ pohonu</label>
                        <input type="text" id="drivetrain">
                    </div>
                    <button type="submit" class="btn">P콏idat z치vod</button>
                </form>
            </div>

            <div class="section">
                <h2>Zadat v칳sledky z치vodu</h2>
                <form id="results-form">
                    <div class="form-group">
                        <label>Vyberte z치vod</label>
                        <select id="select-race" required></select>
                    </div>
                    <div class="form-group">
                        <label>1. m칤sto</label>
                        <select id="pos1" required>
                            <option value="">Vyberte jezdce</option>
                            <option value="Viki">Viki</option>
                            <option value="M치ra">M치ra</option>
                            <option value="Maty">Maty</option>
                            <option value="Hardy">Hardy</option>
                            <option value="Ondra">Ondra</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>2. m칤sto</label>
                        <select id="pos2" required>
                            <option value="">Vyberte jezdce</option>
                            <option value="Viki">Viki</option>
                            <option value="M치ra">M치ra</option>
                            <option value="Maty">Maty</option>
                            <option value="Hardy">Hardy</option>
                            <option value="Ondra">Ondra</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>3. m칤sto</label>
                        <select id="pos3" required>
                            <option value="">Vyberte jezdce</option>
                            <option value="Viki">Viki</option>
                            <option value="M치ra">M치ra</option>
                            <option value="Maty">Maty</option>
                            <option value="Hardy">Hardy</option>
                            <option value="Ondra">Ondra</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>YouTube URL (nepovinn칠)</label>
                        <input type="url" id="youtube-url">
                    </div>
                    <button type="submit" class="btn">Ulo쬴t v칳sledky</button>
                </form>
            </div>
        </div>

    <!-- Firebase SDK + konfigurace -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
      import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-analytics.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCkR-AyJK2vFnz0V2HTuz2b3zCaLMxbXtI",
        authDomain: "test-gt7.firebaseapp.com",
        projectId: "test-gt7",
        storageBucket: "test-gt7.firebasestorage.app",
        messagingSenderId: "928154989107",
        appId: "1:928154989107:web:20a34d0009fa75bd1ee946",
        measurementId: "G-1SG8DW1KQ9"
      };

      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const db = getFirestore(app);

      window._firestore = db;
      window._firestoreCollection = collection;
      window._firestoreAdd = addDoc;
      window._firestoreOnSnapshot = onSnapshot;
      window._firestoreDoc = doc;
      window._firestoreUpdate = updateDoc;
    </script>

    <script>
      let data = { currentSeason: { races: [] }, archive: [] };

      function loadData() {
        const racesCol = window._firestoreCollection(window._firestore, "races");
        window._firestoreOnSnapshot(racesCol, (snapshot) => {
          const races = [];
          snapshot.forEach(doc => races.push({ id: doc.id, ...doc.data() }));
          data.currentSeason.races = races;
          renderAll();
        });
      }

      async function addRaceToFirestore(race) {
        await window._firestoreAdd(window._firestoreCollection(window._firestore, "races"), race);
      }

      async function saveResultsToFirestore(raceId, results, youtubeUrl) {
        const raceRef = window._firestoreDoc(window._firestore, "races", raceId);
        await window._firestoreUpdate(raceRef, {
          results: results,
          youtubeUrl: youtubeUrl || null
        });
      }

      document.addEventListener('DOMContentLoaded', () => {
        loadData();

        document.getElementById('race-form').addEventListener('submit', async (e) => {
          e.preventDefault();
          const race = {
            date: document.getElementById('race-date').value,
            circuit: document.getElementById('circuit-name').value,
            cars: document.getElementById('allowed-cars').value,
            performanceIndex: document.getElementById('performance-index').value,
            tuning: document.getElementById('tuning').value,
            tires: document.getElementById('tires').value,
            laps: document.getElementById('laps').value,
            tireWear: document.getElementById('tire-wear').value,
            fuelConsumption: document.getElementById('fuel-consumption').value,
            refuelSpeed: document.getElementById('refuel-speed').value,
            additionalInfo: document.getElementById('additional-info').value,
            manufacturer: document.getElementById('manufacturer').value,
            drivetrain: document.getElementById('drivetrain').value
          };

          await addRaceToFirestore(race);
          e.target.reset();
        });

        document.getElementById('results-form').addEventListener('submit', async (e) => {
          e.preventDefault();
          const select = document.getElementById('select-race');
          const raceId = select.value;
          if (!raceId) return;

          const results = {
            first: document.getElementById('pos1').value,
            second: document.getElementById('pos2').value,
            third: document.getElementById('pos3').value
          };
          const youtubeUrl = document.getElementById('youtube-url').value;

          await saveResultsToFirestore(raceId, results, youtubeUrl);
          e.target.reset();
        });
      });
    </script>
</body>
</html>
