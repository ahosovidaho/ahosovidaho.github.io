<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hric-Pic-Ma-Ma-Tama Championship 2025</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { background:#111; color:#fff; font-family:-apple-system, BlinkMacSystemFont, sans-serif; margin:0; padding:0;}
header { text-align:center; padding:20px; color:#0af; }
nav { display:flex; justify-content:center; background:#222; }
nav button { background:#222; color:#fff; border:none; padding:10px 20px; cursor:pointer; font-size:16px; }
nav button:hover { background:#333; }
section { padding:20px; }
table { width:100%; border-collapse: collapse; margin-top:20px; }
th, td { border:1px solid #444; padding:8px; text-align:center; }
th { background:#333; }
</style>
</head>
<body>

<header>
<h1>Hric-Pic-Ma-Ma-Tama Championship 2025</h1>
</header>

<nav>
<button onclick="showTab('aktualni')">Aktuální sezóna</button>
<button onclick="showTab('statistiky')">Statistiky</button>
<button onclick="showTab('archiv')">Archiv sezón</button>
<button onclick="showTab('profil')">Profil závodníka</button>
<button onclick="showTab('admin')">Admin</button>
</nav>

<section id="aktualni"></section>
<section id="statistiky" style="display:none;">Statistiky a H2H zde...</section>
<section id="archiv" style="display:none;">Archiv sezón zde...</section>
<section id="profil" style="display:none;">Profil závodníka zde...</section>
<section id="admin" style="display:none;">Admin panel zde...</section>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyCkR-AyJK2vFnz0V2HTuz2b3zCaLMxbXtI",
authDomain: "test-gt7.firebaseapp.com",
projectId: "test-gt7",
storageBucket: "test-gt7.firebasestorage.app",
messagingSenderId: "928154989107",
appId: "1:928154989107:web:20a34d0009fa75bd1ee946",
measurementId: "G-1SG8DW1KQ9"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Závodníci
const zavodnici = ["Viki","Mára","Maty","Hardy","Ondra"];
const bodyRozdeleni = [10,8,6,4,2]; // 1.–5. místo, DNS=0

// Závody s výsledky podle potvrzené tabulky
const zavody = [
{ datum:"2025-03-01T15:00", nazev:"American Muscle", trat:"Daytona road circuit", vysledky:["Viki","Maty","Hardy","DNS","DNS"] },
{ datum:"2025-03-15T15:00", nazev:"Limonádový Joe", trat:"Red Bull Ring", vysledky:["Viki","Hardy","Maty","DNS","DNS"] },
{ datum:"2025-04-01T15:00", nazev:"Forza Italia", trat:"Monza", vysledky:["Hardy","Viki","Maty","DNS","DNS"] },
{ datum:"2025-04-15T15:00", nazev:"Dovolená v Chorvatsku", trat:"Dragon Trail - přímořská trať", vysledky:["Viki","Maty","Hardy","DNS","DNS"] },
{ datum:"2025-05-01T15:00", nazev:"Tokyo Drift", trat:"Suzuka", vysledky:["Viki","Maty","Hardy","DNS","DNS"] },
{ datum:"2025-05-15T15:00", nazev:"Po stopách Jamese Bonda", trat:"Brands Hatch", vysledky:["Maty","Viki","Hardy","DNS","DNS"] },
{ datum:"2025-06-01T15:00", nazev:"24h Le Mans", trat:"Le Mans", vysledky:["Viki","Hardy","Maty (PEN)","DNS","DNS"] }
];

// Přepínání záložek
function showTab(tab){
['aktualni','statistiky','archiv','profil','admin'].forEach(t=>{
document.getElementById(t).style.display = (t===tab)?'block':'none';
});
}

// Vypočet bodů a tabulka
async function nactiAktualni(){
const sekce = document.getElementById('aktualni');
sekce.innerHTML = "<h2>Výsledky závodů 2025</h2>";

let body = {}, podia = {}, dns = {};
zavodnici.forEach(z=>{body[z]=0; podia[z]=0; dns[z]=0;});

// Dataset pro graf
let labels=[], datasets={};
zavodnici.forEach(z=>datasets[z]=[]);

// Tabulka výsledků
let html='<table><tr><th>Datum</th><th>Závod</th><th>Trať</th>';
for(let i=1;i<=5;i++){ html+=`<th>${i}. místo</th>`; }
html+='</tr>';

// Pro každý závod
zavody.forEach(z=>{
  labels.push(z.nazev);
  html+='<tr><td>'+new Date(z.datum).toLocaleDateString()+'</td><td>'+z.nazev+'</td><td>'+z.trat+'</td>';
  
  z.vysledky.forEach((v,i)=>{
    let zavodnik = v;
    let b = 0;
    if(v==="DNS") { 
      zavodnik = zavodnici[i]; 
      dns[zavodnik]++; 
      b=0; 
    } else if(v.includes("(PEN)")) { 
      zavodnik = v.replace(" (PEN)",""); 
      b=6; 
      body[zavodnik]+=b; 
      podia[zavodnik]+=1; 
    } else { 
      b = bodyRozdeleni[i]; 
      body[v]+=b; 
      podia[v]+=(i<3)?1:0; 
    }
    html+=`<td>${v}</td>`;
  });
  html+='</tr>';
});

// Celkové pořadí – seřazeno podle bodů sestupně
html+='<h3>Celkové pořadí</h3>';
html+='<table><tr><th>Závodník</th><th>Body</th><th>Pódiová umístění</th><th>DNS</th></tr>';
const serazeni = [...zavodnici].sort((a,b)=>body[b]-body[a]);
serazeni.forEach(z=>{
  html+=`<tr><td>${z}</td><td>${body[z]}</td><td>${podia[z]}</td><td>${dns[z]}</td></tr>`;
});
html+='</table>';

// Naplnění datasetu pro graf kumulativních bodů
zavodnici.forEach(z=>datasets[z]=[]); // reset
zavodnici.forEach(z=>{body[z]=0;}); // reset

zavody.forEach(z=>{
  z.vysledky.forEach((v,i)=>{
    let zavodnik = v;
    let b = 0;
    if(v==="DNS") { 
      zavodnik = zavodnici[i]; b=0; 
    } else if(v.includes("(PEN)")) { 
      zavodnik = v.replace(" (PEN)",""); 
      b=6; 
    } else { 
      b = bodyRozdeleni[i]; 
    }
    if(!v.includes("DNS")) body[zavodnik]+=b;
  });
  zavodnici.forEach(z=>datasets[z].push(body[z]));
});

sekce.innerHTML += html + '<canvas id="grafBody" height="200"></canvas>';

// Graf
const ctx = document.getElementById('grafBody').getContext('2d');
new Chart(ctx,{
  type:'line',
  data:{
    labels:labels,
    datasets: zavodnici.map(z=>({
      label:z,
      data:datasets[z],
      borderColor:z==="Viki"?"#0af":z==="Mára"?"#f00":z==="Maty"?"#ff0":z==="Hardy"?"#0f0":"#f0f",
      fill:false
    }))
  },
  options:{responsive:true, plugins:{legend:{labels:{color:"#fff"}}}, scales:{y:{beginAtZero:true, ticks:{color:"#fff"}}, x:{ticks:{color:"#fff"}}}}
});
}

nactiAktualni();
</script>
</body>
</html>
