<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hric-Pic-Ma-Ma-Tama Championship 2025</title>
<style>
  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #121212; color: #fff; margin:0; padding:0;}
  header { padding:20px; text-align:center; background: linear-gradient(90deg, #0d1b36, #610000); }
  nav { display:flex; justify-content:center; background:#1e1e1e; }
  nav button { background:none; border:none; color:#fff; padding:15px 20px; cursor:pointer; font-size:16px; }
  nav button.active { border-bottom: 3px solid #ff0000; }
  section { padding:20px; display:none; }
  section.active { display:block; }
  table { width:100%; border-collapse: collapse; margin-top:20px;}
  th, td { border:1px solid #444; padding:8px; text-align:center; }
  th { background:#222; }
  canvas { max-width:100%; height:auto; margin-top:20px;}
  .race-banner { padding:20px; background:#222; margin-bottom:20px; border-radius:8px; }
  .race-banner h3 { margin-top:0; }
  input, select { padding:5px; margin:5px 0; width:100%; background:#222; color:#fff; border:1px solid #555; border-radius:4px;}
  button.adminBtn { margin-top:10px; padding:10px 15px; cursor:pointer; border:none; background:#ff0000; color:#fff; border-radius:4px; }
</style>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<header>
  <h1>Hric-Pic-Ma-Ma-Tama Championship 2025</h1>
</header>

<nav>
  <button class="tablink active" data-tab="aktualni">Aktuální sezóna</button>
  <button class="tablink" data-tab="statistiky">Statistiky</button>
  <button class="tablink" data-tab="archiv">Archiv sezón</button>
  <button class="tablink" data-tab="profil">Profil závodníka</button>
  <button class="tablink" data-tab="admin">Admin</button>
</nav>

<section id="aktualni" class="active">
  <div id="nextRaceBanner" class="race-banner">
    <h3>Nejbližší závod</h3>
    <div id="countdown"></div>
    <div id="raceDetails"></div>
  </div>

  <h2>Vývoj bodů</h2>
  <canvas id="pointsChart"></canvas>

  <h2>Výsledky závodů</h2>
  <table id="results">
    <thead>
      <tr>
        <th>Datum</th><th>Závod a trať</th><th>1.</th><th>2.</th><th>3.</th><th>4.</th><th>5.</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>Naplánované závody</h2>
  <table id="planned">
    <thead>
      <tr>
        <th>Datum</th><th>Závod a trať</th><th>Počet kol</th><th>Pneumatiky</th><th>Spotřeba</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>Pořadí závodníků</h2>
  <table id="standings">
    <thead>
      <tr><th>Závodník</th><th>Body</th><th>Pódiová umístění</th><th>DNS</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<section id="statistiky"><h2>Statistiky</h2></section>
<section id="archiv"><h2>Archiv sezón</h2></section>
<section id="profil"><h2>Profil závodníka</h2></section>

<section id="admin">
  <h2>Admin</h2>
  <button id="loginBtn">Přihlásit se přes Google</button>
  <div>
    <h3>Přidat/uptavit závod</h3>
    <input type="text" id="raceName" placeholder="Název závodu">
    <input type="text" id="raceTrack" placeholder="Trať">
    <input type="datetime-local" id="raceDate">
    <input type="number" id="raceLaps" placeholder="Počet kol">
    <input type="text" id="raceTyres" placeholder="Povinné pneumatiky">
    <input type="text" id="raceFuel" placeholder="Spotřeba (L)">
    <button class="adminBtn" id="addRaceBtn">Uložit závod</button>
  </div>
</section>

<script>
  // --- TAB ---
  document.querySelectorAll('.tablink').forEach(btn=>{
    btn.addEventListener('click',()=>{
      document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
      document.getElementById(btn.dataset.tab).classList.add('active');
      document.querySelectorAll('.tablink').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
    });
  });

  // --- FIREBASE ---
  const firebaseConfig = {
    apiKey: "AIzaSyCkR-AyJK2vFnz0V2HTuz2b3zCaLMxbXtI",
    authDomain: "test-gt7.firebaseapp.com",
    projectId: "test-gt7",
    storageBucket: "test-gt7.firebasestorage.app",
    messagingSenderId: "928154989107",
    appId: "1:928154989107:web:20a34d0009fa75bd1ee946",
    measurementId: "G-1SG8DW1KQ9"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  document.getElementById('loginBtn').addEventListener('click', ()=>{
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).then(result=>{
      alert('Přihlášeno: '+result.user.displayName);
    }).catch(console.error);
  });

  // --- DATA ---
  const drivers=["Viki","Mára","Maty","Hardy","Ondra"];
  const pointsMap=[10,8,6,4,2];
  let racesData=[
    {nazev:"American Muscle", trat:"Daytona road circuit", datum:"2025-03-01T15:00", vysledky:["Viki","Maty","Hardy","DNS","DNS"], kol:12, pneumatiky:"Soft", spotreba:"15L"},
    {nazev:"Limonádový Joe", trat:"Red Bull Ring", datum:"2025-03-15T15:00", vysledky:["Viki","Hardy","Maty","DNS","DNS"], kol:10, pneumatiky:"Medium", spotreba:"14L"},
    {nazev:"Forza Italia", trat:"Monza", datum:"2025-04-01T15:00", vysledky:["Hardy","Viki","Maty","DNS","DNS"], kol:8, pneumatiky:"Hard", spotreba:"13L"},
    {nazev:"Dovolená v Chorvatsku", trat:"Dragon Trail - přímořská trať", datum:"2025-04-15T15:00", vysledky:["Viki","Maty","Hardy","DNS","DNS"], kol:12, pneumatiky:"Soft", spotreba:"15L"},
    {nazev:"Tokyo Drift", trat:"Suzuka", datum:"2025-05-01T15:00", vysledky:["Viki","Maty","Hardy","DNS","DNS"], kol:14, pneumatiky:"Soft", spotreba:"16L"},
    {nazev:"Po stopách Jamese Bonda", trat:"Brands Hatch", datum:"2025-05-15T15:00", vysledky:["Maty","Viki","Hardy","DNS","DNS"], kol:10, pneumatiky:"Medium", spotreba:"14L"},
    {nazev:"24h Le Mans", trat:"Le Mans", datum:"2025-06-01T15:00", vysledky:["Viki","Hardy","Maty","DNS","DNS"], kol:24, pneumatiky:"Soft", spotreba:"25L"},
    {nazev:"Monaco GP", trat:"Monaco", datum:"2025-06-15T15:00", kol:16, pneumatiky:"Soft", spotreba:"18L"},
    {nazev:"Indy 500", trat:"Indianapolis", datum:"2025-07-01T15:00", kol:20, pneumatiky:"Medium", spotreba:"22L"}
  ];

  // --- FUNKCE ---
  function calculateStandings(){
    const standings = {};
    drivers.forEach(d=>standings[d]={points:0,podium:0,dns:0});
    racesData.forEach(r=>{
      if(!r.vysledky) return;
      drivers.forEach(d=>{
        const idx = r.vysledky.indexOf(d);
        if(idx===-1 || r.vysledky[idx]==="DNS"){ standings[d].dns++; return;}
        standings[d].points += pointsMap[idx]||0;
        if(idx<3) standings[d].podium++;
      });
    });
    return Object.entries(standings).sort((a,b)=>b[1].points - a[1].points);
  }

  function renderStandings(){
    const tbody=document.querySelector('#standings tbody');
    tbody.innerHTML="";
    calculateStandings().forEach(([name,data])=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${name}</td><td>${data.points}</td><td>${data.podium}</td><td>${data.dns}</td>`;
      tbody.appendChild(tr);
    });
  }

  function renderResults(){
    const tbody=document.querySelector('#results tbody');
    tbody.innerHTML="";
    racesData.filter(r=>r.vysledky).sort((a,b)=>new Date(b.datum)-new Date(a.datum)).forEach(r=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${new Date(r.datum).toLocaleString()}</td><td>${r.nazev} / ${r.trat}</td>` +
        r.vysledky.map(d=>`<td>${d}</td>`).join('');
      tbody.appendChild(tr);
    });
  }

  function renderPlanned(){
    const tbody=document.querySelector('#planned tbody');
    tbody.innerHTML="";
    racesData.filter(r=>!r.vysledky).sort((a,b)=>new Date(a.datum)-new Date(b.datum)).forEach(r=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${new Date(r.datum).toLocaleString()}</td><td>${r.nazev} / ${r.trat}</td><td>${r.kol||''}</td><td>${r.pneumatiky||''}</td><td>${r.spotreba||''}</td>`;
      tbody.appendChild(tr);
    });
  }

  function renderNextRace(){
    const nextRace = racesData.filter(r=>!r.vysledky).sort((a,b)=>new Date(a.datum)-new Date(b.datum))[0];
    if(!nextRace) return;
    const countdownEl=document.getElementById('countdown');
    const detailsEl=document.getElementById('raceDetails');
    detailsEl.innerHTML=`Počet kol: ${nextRace.kol}, Pneumatiky: ${nextRace.pneumatiky}, Spotřeba: ${nextRace.spotreba}`;

    function updateCountdown(){
      const diff=new Date(nextRace.datum)-new Date();
      if(diff<=0){ countdownEl.textContent="Závod právě začal!"; return;}
      const d=Math.floor(diff/86400000);
      const h=Math.floor((diff%86400000)/3600000);
      const m=Math.floor((diff%3600000)/60000);
      const s=Math.floor((diff%60000)/1000);
      countdownEl.textContent=`Do závodu zbývá: ${d} dní, ${h} hodin, ${m} minut, ${s} sekund`;
    }
    updateCountdown();
    setInterval(updateCountdown,1000);
  }

  function renderPointsChart(){
    const ctx=document.getElementById('pointsChart').getContext('2d');
    const datasets=drivers.map(d=>{
      let sum=0;
      const data=racesData.map(r=>{
        if(!r.vysledky) return sum;
        const idx=r.vysledky.indexOf(d);
        if(idx===-1 || r.vysledky[idx]==="DNS") return sum;
        sum+=pointsMap[idx]||0;
        return sum;
      });
      return {label:d,data, borderColor:getRandomColor(), fill:false, tension:0.1};
    });
    new Chart(ctx,{type:'line',data:{labels:racesData.map(r=>r.nazev),datasets},options:{responsive:true,plugins:{legend:{labels:{color:'#fff'}}},scales:{x:{ticks:{color:'#fff'}},y:{ticks:{color:'#fff'}}}}});
  }

  function getRandomColor(){ const letters="0123456789ABCDEF"; return "#"+Array.from({length:6}).map(()=>letters[Math.floor(Math.random()*16)]).join(''); }

  // --- ADMIN ---
  document.getElementById('addRaceBtn').addEventListener('click',()=>{
    const race={nazev:document.getElementById('raceName').value,
                trat:document.getElementById('raceTrack').value,
                datum:document.getElementById('raceDate').value,
                kol:document.getElementById('raceLaps').value,
                pneumatiky:document.getElementById('raceTyres').value,
                spotreba:document.getElementById('raceFuel').value};
    if(race.nazev && race.trat && race.datum){
      racesData.push(race);
      renderPlanned();
      renderNextRace();
      alert('Závod přidán.');
    } else { alert('Vyplň název, trať a datum.'); }
  });

  // --- INIT ---
  renderStandings();
  renderResults();
  renderPlanned();
  renderNextRace();
  renderPointsChart();
</script>

</body>
</html>
