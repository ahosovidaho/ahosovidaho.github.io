<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hric-Pic-Ma-Ma-Tama Championship 2025</title>
<style>
body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #121212; color: #fff; margin:0; padding:0;}
header { padding:20px; text-align:center; background: linear-gradient(90deg, #0d1b36, #610000); }
nav { display:flex; justify-content:center; background:#1e1e1e; }
nav button { background:none; border:none; color:#fff; padding:15px 20px; cursor:pointer; font-size:16px; }
nav button.active { border-bottom: 3px solid #ff0000; }
section { padding:20px; display:none; }
section.active { display:block; }
table { width:100%; border-collapse: collapse; margin-top:20px;}
th, td { border:1px solid #444; padding:8px; text-align:center; }
th { background:#222; }
canvas { max-width:100%; height:auto; }
.race-banner { padding:10px; margin:10px 0; background:#1e1e1e; border:1px solid #444; border-radius:8px;}
.race-banner h3 { margin:0 0 5px 0;}
input, select { margin:5px 0; padding:5px; width:100%; background:#222; color:#fff; border:1px solid #444; border-radius:4px;}
button.add-btn, button.save-btn { padding:8px 12px; margin-top:5px; cursor:pointer; border:none; border-radius:4px; background:#610000; color:#fff;}
</style>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<header>
  <h1>Hric-Pic-Ma-Ma-Tama Championship 2025</h1>
</header>

<nav>
  <button class="tablink active" data-tab="aktualni">Aktuální sezóna</button>
  <button class="tablink" data-tab="statistiky">Statistiky</button>
  <button class="tablink" data-tab="archiv">Archiv sezón</button>
  <button class="tablink" data-tab="profil">Profil závodníka</button>
  <button class="tablink" data-tab="admin">Admin</button>
</nav>

<section id="aktualni" class="active">
  <h2>Nejbližší závod</h2>
  <div id="nextRace" class="race-banner">
    <h3 id="nextRaceTitle">---</h3>
    <p id="nextRaceDetails"></p>
    <p id="countdown"></p>
  </div>

  <h2>Vývoj bodů</h2>
  <canvas id="pointsChart"></canvas>

  <h2>Pořadí závodníků</h2>
  <table id="standings">
    <thead>
      <tr><th>Závodník</th><th>Body</th><th>Pódiová umístění</th><th>DNS</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>Výsledky závodů</h2>
  <table id="results">
    <thead>
      <tr><th>Datum</th><th>Závod a trať</th><th>1. místo</th><th>2. místo</th><th>3. místo</th><th>4. místo</th><th>5. místo</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>Naplánované závody</h2>
  <table id="upcoming">
    <thead>
      <tr><th>Datum</th><th>Závod a trať</th><th>Počet kol</th><th>Spotřeba</th><th>Povinné pneumatiky</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<section id="statistiky">
  <h2>Statistiky</h2>
  <div id="statsBanner">Statistiky a H2H porovnání</div>
</section>

<section id="archiv">
  <h2>Archiv sezón</h2>
  <div id="archiveBanner">Sezónní výsledky</div>
</section>

<section id="profil">
  <h2>Profil závodníka</h2>
  <div id="profileBanner">Informace a oblíbené auta závodníků</div>
</section>

<section id="admin">
  <h2>Admin</h2>
  <button id="loginBtn">Přihlásit se přes Google</button>
  <div id="adminBanner">
    <h3>Přidat nový závod</h3>
    <input type="text" id="adminName" placeholder="Název závodu">
    <input type="text" id="adminTrack" placeholder="Trať">
    <input type="datetime-local" id="adminDate" placeholder="Datum (nepovinné)">
    <input type="number" id="adminLaps" placeholder="Počet kol">
    <input type="text" id="adminFuel" placeholder="Spotřeba">
    <input type="text" id="adminTires" placeholder="Povinné pneumatiky">
    <button class="add-btn" id="addRaceBtn">Přidat závod</button>
  </div>
</section>

<script>
// --- TAB SWITCH ---
const tabs = document.querySelectorAll('.tablink');
tabs.forEach(btn=>{
  btn.addEventListener('click',()=> {
    document.querySelectorAll('section').forEach(sec=>sec.classList.remove('active'));
    document.querySelector('#'+btn.dataset.tab).classList.add('active');
    tabs.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
  });
});

// --- FIREBASE INIT ---
const firebaseConfig = {
  apiKey: "AIzaSyCkR-AyJK2vFnz0V2HTuz2b3zCaLMxbXtI",
  authDomain: "test-gt7.firebaseapp.com",
  projectId: "test-gt7",
  storageBucket: "test-gt7.firebasestorage.app",
  messagingSenderId: "928154989107",
  appId: "1:928154989107:web:20a34d0009fa75bd1ee946",
  measurementId: "G-1SG8DW1KQ9"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// --- LOGIN ---
document.getElementById('loginBtn').addEventListener('click', ()=>{
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider).then(result=>{
    alert('Přihlášeno: '+result.user.displayName);
  }).catch(console.error);
});

// --- DATA ---
const drivers = ["Viki","Mára","Maty","Hardy","Ondra"];
let racesData = [
  {datum:"2025-03-01T15:00", nazev:"American Muscle", trat:"Daytona road circuit", vysledky:["Viki","Maty","Hardy","DNS","DNS"], kol:10, spotreba:"12L", pneu:"Soft"},
  {datum:"2025-03-15T15:00", nazev:"Limonádový Joe", trat:"Red Bull Ring", vysledky:["Viki","Hardy","Maty","DNS","DNS"], kol:8, spotreba:"10L", pneu:"Medium"},
  {datum:"2025-04-01T15:00", nazev:"Forza Italia", trat:"Monza", vysledky:["Hardy","Viki","Maty","DNS","DNS"], kol:12, spotreba:"14L", pneu:"Hard"},
  {datum:"2025-04-15T15:00", nazev:"Dovolená v Chorvatsku", trat:"Dragon Trail - přímořská trať", vysledky:["Viki","Maty","Hardy","DNS","DNS"], kol:15, spotreba:"13L", pneu:"Soft"},
  {datum:"2025-05-01T15:00", nazev:"Tokyo Drift", trat:"Suzuka", vysledky:["Viki","Maty","Hardy","DNS","DNS"], kol:10, spotreba:"11L", pneu:"Medium"},
  {datum:"2025-05-15T15:00", nazev:"Po stopách Jamese Bonda", trat:"Brands Hatch", vysledky:["Maty","Viki","Hardy","DNS","DNS"], kol:9, spotreba:"12L", pneu:"Soft"},
  {datum:"2025-06-01T15:00", nazev:"24h Le Mans", trat:"Le Mans", vysledky:["Viki","Hardy","Maty","DNS","DNS"], kol:24, spotreba:"20L", pneu:"Hard"},
  {datum:null, nazev:"Monaco GP", trat:"Monaco", kol:10, spotreba:"10L", pneu:"Soft"},
  {datum:null, nazev:"Indy 500", trat:"Indianapolis", kol:15, spotreba:"15L", pneu:"Medium"}
];
const pointsMap = [10,8,6,4,2]; //1.-5.místo

// --- STANDINGS ---
function calculateStandings(){
  const standings = {};
  drivers.forEach(d=>standings[d]={points:0,podium:0,dns:0});
  racesData.filter(r=>r.vysledky).forEach(r=>{
    r.vysledky.forEach((d,i)=>{
      if(d==="DNS"){ standings[drivers[i]].dns++; return;}
      standings[d].points += pointsMap[i] || 0;
      if(i<3) standings[d].podium++;
    });
  });
  return Object.entries(standings).sort((a,b)=>b[1].points - a[1].points);
}

// --- RENDER STANDINGS ---
const tbodyStandings = document.querySelector('#standings tbody');
function renderStandings(){
  tbodyStandings.innerHTML="";
  calculateStandings().forEach(([name,data])=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${name}</td><td>${data.points}</td><td>${data.podium}</td><td>${data.dns}</td>`;
    tbodyStandings.appendChild(tr);
  });
}

// --- RENDER RESULTS ---
const tbodyResults = document.querySelector('#results tbody');
const tbodyUpcoming = document.querySelector('#upcoming tbody');
function renderRaces(){
  tbodyResults.innerHTML="";
  tbodyUpcoming.innerHTML="";
  const pastRaces = racesData.filter(r=>r.vysledky).sort((a,b)=>new Date(b.datum)-new Date(a.datum));
  const upcomingRaces = racesData.filter(r=>!r.vysledky);
  pastRaces.forEach(r=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${r.datum}</td><td>${r.nazev} / ${r.trat}</td>`+
                   r.vysledky.map(d=>`<td>${d}</td>`).join('');
    tbodyResults.appendChild(tr);
  });
  upcomingRaces.forEach(r=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${r.datum ? r.datum : '-'}</td><td>${r.nazev} / ${r.trat}</td><td>${r.kol}</td><td>${r.spotreba}</td><td>${r.pneu}</td>`;
    tbodyUpcoming.appendChild(tr);
  });
}

// --- NEXT RACE BANNER ---
const nextRaceTitle = document.getElementById('nextRaceTitle');
const nextRaceDetails = document.getElementById('nextRaceDetails');
const countdownEl = document.getElementById('countdown');
function updateNextRace(){
  const now = new Date();
  const upcoming = racesData.filter(r => !r.vysledky && (r.datum ? new Date(r.datum) > now : true))
                            .sort((a,b)=> (a.datum ? new Date(a.datum) : new Date(8640000000000000)) - 
                                          (b.datum ? new Date(b.datum) : new Date(8640000000000000)));
  if(upcoming.length>0){
    const next = upcoming[0];
    nextRaceTitle.textContent = `${next.nazev} / ${next.trat}`;
    nextRaceDetails.textContent = `Kol: ${next.kol} | Spotřeba: ${next.spotreba} | Pneumatiky: ${next.pneu}`;
    if(next.datum){
      const diff = new Date(next.datum)-now;
      const d=Math.floor(diff/86400000);
      const h=Math.floor((diff%86400000)/3600000);
      const m=Math.floor((diff%3600000)/60000);
      const s=Math.floor((diff%60000)/1000);
      countdownEl.textContent = `Do závodu zbývá: ${d} dní, ${h} hodin, ${m} minut, ${s} sekund`;
    } else countdownEl.textContent="";
  } else {
    nextRaceTitle.textContent="Žádné naplánované závody";
    nextRaceDetails.textContent="";
    countdownEl.textContent="";
  }
}
setInterval(updateNextRace,1000);

// --- POINTS CHART ---
const ctx = document.getElementById('pointsChart').getContext('2d');
const datasets = drivers.map(d=>{
  let sum=0;
  const data = racesData.filter(r=>r.vysledky).map(r=>{
    const idx = r.vysledky.indexOf(d);
    if(idx==-1 || r.vysledky[idx]==="DNS") return sum;
    sum+=pointsMap[idx]||0;
    return sum;
  });
  return {label:d,data,borderColor:getRandomColor(),fill:false,tension:0.1};
});
const pointsChart = new Chart(ctx,{type:'line',data:{labels:racesData.filter(r=>r.vysledky).map(r=>r.nazev),datasets},options:{responsive:true,plugins:{legend:{labels:{color:'#fff'}}},scales:{x:{ticks:{color:'#fff'}},y:{ticks:{color:'#fff'}}}}});
function getRandomColor(){const letters="0123456789ABCDEF";return "#"+Array.from({length:6}).map(()=>letters[Math.floor(Math.random()*16)]).join('');}

// --- ADMIN ADD RACE ---
document.getElementById('addRaceBtn').addEventListener('click',()=>{
  const newRace={
    nazev: document.getElementById('adminName').value,
    trat: document.getElementById('adminTrack').value,
    datum: document.getElementById('adminDate').value || null,
    kol: document.getElementById('adminLaps').value,
    spotreba: document.getElementById('adminFuel').value,
    pneu: document.getElementById('adminTires').value
  };
  racesData.push(newRace);
  renderRaces();
  updateNextRace();
  document.getElementById('adminName').value="";
  document.getElementById('adminTrack').value="";
  document.getElementById('adminDate').value="";
  document.getElementById('adminLaps').value="";
  document.getElementById('adminFuel').value="";
  document.getElementById('adminTires').value="";
});

// --- INITIAL RENDER ---
renderRaces();
renderStandings();
updateNextRace();
</script>

</body>
</html>
