<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hric-Pic-Ma-Ma-Tama Championship 2025</title>
<style>
  body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #121212; color: #fff; margin:0; padding:0;}
  header { padding:20px; text-align:center; background: linear-gradient(90deg, #0d1b36, #610000); }
  nav { display:flex; justify-content:center; background:#1e1e1e; flex-wrap:wrap; }
  nav button { background:none; border:none; color:#fff; padding:15px 20px; cursor:pointer; font-size:16px; }
  nav button.active { border-bottom: 3px solid #ff0000; }
  section { padding:20px; display:none; }
  section.active { display:block; }
  table { width:100%; border-collapse: collapse; margin-top:20px;}
  th, td { border:1px solid #444; padding:8px; text-align:center; }
  th { background:#222; }
  canvas { max-width:100%; height:auto; }
  form label { display:block; margin-top:10px; font-weight:bold; }
  form input, form select, form textarea { width:100%; padding:6px; margin-top:4px; background:#1e1e1e; color:#fff; border:1px solid #444; border-radius:4px; }
  form button { margin-top:15px; padding:10px 20px; background:#610000; color:#fff; border:none; cursor:pointer; border-radius:4px; }
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<header>
  <h1>Hric-Pic-Ma-Ma-Tama Championship 2025</h1>
</header>

<nav>
  <button class="tablink active" data-tab="aktualni">Aktuální sezóna</button>
  <button class="tablink" data-tab="statistiky">Statistiky</button>
  <button class="tablink" data-tab="archiv">Archiv sezón</button>
  <button class="tablink" data-tab="profil">Profil závodníka</button>
  <button class="tablink" data-tab="admin">Admin</button>
</nav>

<section id="aktualni" class="active">
  <h2>Nejbližší závod</h2>
  <div id="nextRaceBanner">Zde bude upoutávka na nadcházející závod</div>

  <h2>Vývoj bodů</h2>
  <canvas id="pointsChart"></canvas>

  <h2>Pořadí závodníků</h2>
  <table id="standings">
    <thead>
      <tr><th>Závodník</th><th>Body</th><th>Pódiová umístění</th><th>DNS</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>Výsledky závodů</h2>
  <table id="results">
    <thead>
      <tr>
        <th>Datum</th><th>Závod a trať</th><th>1. místo</th><th>2. místo</th><th>3. místo</th><th>4. místo</th><th>5. místo</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>Naplánované závody</h2>
  <table id="planned">
    <thead>
      <tr><th>Datum</th><th>Závod a trať</th><th>Povolená vozidla</th><th>Kategorie</th><th>Tuning</th><th>Rovnováha výkonu</th><th>Pneumatiky</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<section id="statistiky"><h2>Statistiky</h2></section>
<section id="archiv"><h2>Archiv sezón</h2></section>
<section id="profil"><h2>Profil závodníka</h2></section>

<section id="admin">
  <h2>Admin – Přidat / Upravit závod</h2>
  <button id="loginBtn">Přihlásit se přes Google</button>

  <form id="raceForm">
    <label for="raceName">Název závodu:</label>
    <input type="text" id="raceName" required>

    <label for="raceTrack">Trať:</label>
    <input type="text" id="raceTrack" required>

    <label for="raceDate">Datum a čas:</label>
    <input type="datetime-local" id="raceDate">

    <label for="allowedVehicles">Povolená vozidla:</label>
    <input type="text" id="allowedVehicles">

    <label for="allowedCategory">Povolená kategorie:</label>
    <select id="allowedCategory">
      <option value="">--vyber--</option>
      <option>Gr.1</option>
      <option>Gr.2</option>
      <option>Gr.3</option>
      <option>Gr.4</option>
      <option>Gr.B</option>
      <option>VGT</option>
      <option>Open</option>
    </select>

    <label for="tuning">Tuning:</label>
    <select id="tuning">
      <option value="">--vyber--</option>
      <option>ANO</option>
      <option>NE</option>
    </select>

    <label for="bo">Rovnováha výkonu:</label>
    <select id="bo">
      <option value="">--vyber--</option>
      <option>ANO</option>
      <option>NE</option>
    </select>

    <label for="allowedTyres">Povolené pneumatiky:</label>
    <select id="allowedTyres">
      <option value="">--vyber--</option>
      <option>Komfortní</option>
      <option>Sportovní</option>
      <option>Závodní</option>
      <option>Na sníh</option>
      <option>Na šotolinu</option>
    </select>

    <label for="mandatoryTyre">Povinná směs:</label>
    <select id="mandatoryTyre">
      <option value="">--vyber--</option>
      <option>Tvrdá</option>
      <option>Střední</option>
      <option>Měkká</option>
    </select>

    <label for="tyreWear">Opotřebení pneumatik:</label>
    <input type="text" id="tyreWear">

    <label for="fuelConsumption">Spotřeba paliva:</label>
    <input type="text" id="fuelConsumption">

    <label for="fuelRefill">Rychlost doplňování paliva:</label>
    <input type="text" id="fuelRefill">

    <label for="mandatoryPitstop">Povinný pit-stop:</label>
    <select id="mandatoryPitstop">
      <option value="">--vyber--</option>
      <option>ANO</option>
      <option>NE</option>
    </select>

    <label for="extraInfo">Doplňující info:</label>
    <textarea id="extraInfo" rows="3"></textarea>

    <button type="submit">Uložit závod</button>
  </form>
</section>

<script>
  const tabs = document.querySelectorAll('.tablink');
  tabs.forEach(btn=>{
    btn.addEventListener('click',()=> {
      document.querySelectorAll('section').forEach(sec=>sec.classList.remove('active'));
      document.querySelector('#'+btn.dataset.tab).classList.add('active');
      tabs.forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
    });
  });

  const firebaseConfig = {
    apiKey: "AIzaSyCkR-AyJK2vFnz0V2HTuz2b3zCaLMxbXtI",
    authDomain: "test-gt7.firebaseapp.com",
    projectId: "test-gt7",
    storageBucket: "test-gt7.firebasestorage.app",
    messagingSenderId: "928154989107",
    appId: "1:928154989107:web:20a34d0009fa75bd1ee946",
    measurementId: "G-1SG8DW1KQ9"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  document.getElementById('loginBtn').addEventListener('click', ()=>{
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).then(result=>{
      alert('Přihlášeno: '+result.user.displayName);
    }).catch(console.error);
  });

  // --- Přidání / editace závodů ---
  const raceForm = document.getElementById('raceForm');
  raceForm.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const data = {
      name: document.getElementById('raceName').value,
      track: document.getElementById('raceTrack').value,
      date: document.getElementById('raceDate').value || null,
      allowedVehicles: document.getElementById('allowedVehicles').value,
      allowedCategory: document.getElementById('allowedCategory').value,
      tuning: document.getElementById('tuning').value,
      bo: document.getElementById('bo').value,
      allowedTyres: document.getElementById('allowedTyres').value,
      mandatoryTyre: document.getElementById('mandatoryTyre').value,
      tyreWear: document.getElementById('tyreWear').value,
      fuelConsumption: document.getElementById('fuelConsumption').value,
      fuelRefill: document.getElementById('fuelRefill').value,
      mandatoryPitstop: document.getElementById('mandatoryPitstop').value,
      extraInfo: document.getElementById('extraInfo').value
    };
    await db.collection('plannedRaces').add(data);
    raceForm.reset();
    alert('Závod uložen.');
    loadPlannedRaces();
  });

  async function loadPlannedRaces(){
    const tbody = document.querySelector('#planned tbody');
    tbody.innerHTML = '';
    const snapshot = await db.collection('plannedRaces').orderBy('date','asc').get();
    snapshot.forEach(doc=>{
      const r = doc.data();
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${r.date||''}</td><td>${r.name} / ${r.track}</td><td>${r.allowedVehicles||''}</td>
        <td>${r.allowedCategory||''}</td><td>${r.tuning||''}</td><td>${r.bo||''}</td><td>${r.allowedTyres||''}</td>`;
      tbody.appendChild(tr);
    });
  }
  loadPlannedRaces();
</script>

</body>
</html>
